
<!-- Post Layout Start -->

<!DOCTYPE html>
<html lang="en">

  
<!-- HEAD Start -->

<head>
  


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Blog and website of Shashidhar, blogging mainly for tech. Opinions expressed are mine.">
  <meta name="author" content="Shashidhar">
  <meta name="keywords" content="">
  <link rel="canonical" href="/jekyll/update/2015/10/27/distributed-configuration-management-with-zookeeper.html">
  <title>Shashidhar  | Zookeeper - Dynamic Configuration Source with Archaius</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/css/grayscale.css" rel="stylesheet">
  

  <!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/rrssb.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!--  -->

  

  


  <!-- iOS Web App mode -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="36x36" href="/img/web-app/icon-36p.png">
  <link rel="apple-touch-icon" sizes="48x48" href="/img/web-app/icon-48p.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/web-app/icon-72p.png">
  <link rel="apple-touch-icon" sizes="96x96" href="/img/web-app/icon-96p.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/web-app/icon-144p.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/img/web-app/icon-192p.png">

  <!-- Android Web App mode -->

  <link rel="manifest" href="/manifest.json">




  



</head>

<!-- HEAD End -->


  <body>

    
<!-- Navigation Start -->

<nav class="navbar navbar-custom navbar-fixed-top" role="navigation" style="background:black;">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button>
      
        <a class="navbar-brand" href="/">
      
          <div>
            <!--  -->
            Shashidhar
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav">
        
          <!-- Blog, Post, Tag and Error pages -->
          
            <li>
            
                <a href="/#about"> About </a>
            
            </li>
          
            <li>
            
              
                <a href="/blog/"> Blog </a>
              
            
            </li>
          
            <li>
            
                <a href="/#cv"> CV </a>
            
            </li>
          
            <li>
            
                <a href="/#timeline"> Timeline </a>
            
            </li>
          
            <li>
            
                <a href="/#contact"> Contact </a>
            
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>

<!-- Navigation End -->


    <section id="post" class="container content-section">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">

          
<!-- Swipe Instructions Start -->

<div id="swipe-instruction">
  <div>
    <p><br><br><br></p>
    <i id="hand-swipe" class="fa fa-hand-o-up"></i>
    <p><strong>
    
    </strong></p>
    <button type="button" class="btn btn-default ok-btn close-swipe-instruction">
      
    </button>
  </div>
</div>

<!-- Swipe Instructions End -->


          <h1 class="text-center"><strong>Zookeeper - Dynamic Configuration Source with Archaius</strong></h1>
          <h4><strong>27 Oct 2015</strong>
            <!-- <small> .  . <a href="/jekyll/update/2015/10/27/distributed-configuration-management-with-zookeeper.html#disqus_thread">Comments</a>
            
            </small> -->
          </h4>

          <p>Dynamic configuration is the ability to change the configuration while system is running. Archaius is the configuration management library which can retrieve properties from several sources and load them into the system dynamically.For a distributed system Apache Zookeeper is the default coordination service. This blog shows</p>

<p><em>How can we create custom listeners for the changes in zookeeper configuration using Zookeeper Watches</em></p>

<p>To accomplish the above task we need to have to components</p>

<ul>
  <li>ZookeeperConfigSource</li>
  <li>ZookeeperUpdateListener</li>
</ul>

<p>Project code can be accessed in <a href="https://github.com/Shasidhar/zookeeper_dynamic_config_source_with_archaius">GitHub</a></p>

<h3 id="zookeeperconfigsource">ZookeeperConfigSource</h3>

<p>Here we are going to use apache curator framework for zookeeper related operations. We need to specify parent node,like <code>/&lt;app&gt;/config</code> as the root node which acts as a parent for all configurations. As you know the data in zookeeper is stored in <code>ZNodes</code> and each <code>ZNode</code> is a node in Zookeeperâ€™s tree similar to a filesystem.</p>

<p>This component initiates listeners on the node specified above with the curator client. By doing so, we can get an update in the listeners whenever data changes under <code>/&lt;app&gt;/config</code>. To accomplish this we use <code>PathChildrenCache</code> recipe from curator framework. This recipe allows us to have listeners and customize them.</p>

<p>Steps:</p>

<ul>
  <li>Create a Zookeeper Config Source of type <code>WatchedConfigurationSource</code> provided by Archaius.</li>
  <li>Override 3 methods <code>getCurrentData</code>,<code>addUpdateListener</code>,<code>addUpdateListener</code></li>
  <li>Define a method to catch different actions and trigger an event</li>
</ul>

<p>Refer <a href="https://github.com/Shasidhar/zookeeper_dynamic_config_source_with_archaius/blob/master/src/main/scala/com/shashidhar/zookeeper/ZookeeperConfigSource.scala">ZookeeperConfigSource</a> for code.</p>

<h3 id="zookeeperupdatelistener">ZookeeperUpdateListener</h3>
<p>We need to extend <code>WatchedUpdateListener</code> interface provided by archaius library and override <code>updateConfiguration</code> method.When ever a change occurs in the source on which this listener is configured the <code>updateConfiguration</code> event is trigerred.</p>

<p>Steps:</p>

<ul>
  <li>Create a listener for ZookeeperConfigSource</li>
  <li>Start the listeners for ZookeeperConfigSource</li>
  <li>Listen for updates in <code>updateConfiguration</code>.</li>
  <li>Perform requried action in <code>updateConfiguration</code> method.</li>
</ul>

<p>Refer <a href="https://github.com/Shasidhar/zookeeper_dynamic_config_source_with_archaius/blob/master/src/main/scala/com/shashidhar/zookeeper/ZookeeperUpdateListener.scala">ZookeeperUpdateListener</a> for code.</p>

<p>Finally we have to bind the Source and Listener.</p>

<pre>
<code data-trim="" class="Scala">

    object ZookeeperMain {
      def main(args: Array[String]) {
        //root node on which we want to listen
        val zkConnectionString = "/<app>/config"
        //Create curator client for the zookeeper
        val client = CuratorFrameworkFactory.newClient(zkConnectionString,
        new ExponentialBackoffRetry(1000, 3))
        //Create zookeeper source
        val source = new ZookeeperConfigSource(client,zkConnectionString)
        //Create listener object
        val listener = new ZookeeperUpdateListener(source)
        listener.init()
      }
    }


</app></code></pre>



          
          <br><br>
          
<!-- Social Buttons Start -->
<style>
.social-buttons {
  text-align: center !important;
  margin: 0 0 25px;
  font-size: 18px;
  line-height: 1.5;
  list-style-position: inside;
}
</style>
<ul class="list-inline social-buttons">
  
    <li><a href="https://twitter.com/shashidhares" target="_blank"><i class="fa fa-twitter fa-fw"></i></a></li>
  
    <li><a href="https://github.com/shasidhar" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
  
    <li><a href="https://www.linkedin.com/in/shasidhares" target="_blank"><i class="fa fa-linkedin fa-fw"></i></a></li>
  
    <li><a href="https://www.facebook.com/shashidhar.eranti" target="_blank"><i class="fa fa-facebook fa-fw"></i></a></li>
  
</ul>

<!-- Social Buttons End -->


        </div>
      </div>
    </section>

    
 <!-- Footer Start -->

<footer>
    <div class="container text-center">
      <!-- <p>Copyright &copy; Shashidhar 2015</p> -->
    </div>
</footer>

<p><br><br><br><br><br><br></p>

<!-- Footer End -->


    
<!-- Javascript Start -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<!-- Custom Theme JavaScript -->
<!--* Start Bootstrap - Grayscale Bootstrap Theme (http://startbootstrap.com)
* Code licensed under the Apache License v2.0.
* For details, see http://www.apache.org/licenses/LICENSE-2.0.-->
<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script>

 <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-71064079-1', 'auto');
    ga('send', 'pageview');
  </script>









  <!-- Disqus -->

  

  







<script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, 'Zookeeper - Dynamic Configuration Source with Archaius', 'https://shasidhare.com/jekyll/update/2015/10/27/distributed-configuration-management-with-zookeeper.html');
  }
}
</script>









<!-- Javascript End -->


  </body>
</html>

<!-- Post Layout End -->
