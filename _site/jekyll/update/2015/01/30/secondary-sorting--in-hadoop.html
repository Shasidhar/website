
<!-- Post Layout Start -->

<!DOCTYPE html>
<html lang="en">

  
<!-- HEAD Start -->

<head>
  


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Blog and website of Shashidhar, blogging mainly for tech. Opinions expressed are mine.">
  <meta name="author" content="Shashidhar">
  <meta name="keywords" content="">
  <link rel="canonical" href="/website/jekyll/update/2015/01/30/secondary-sorting--in-hadoop.html">
  <title>Shashidhar  | Secondary Sorting in Hadoop</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/website/css/grayscale.css" rel="stylesheet">
  

  <!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/website/css/rrssb.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!--  -->

  

  


  <!-- iOS Web App mode -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="36x36" href="/website/img/web-app/icon-36p.png">
  <link rel="apple-touch-icon" sizes="48x48" href="/website/img/web-app/icon-48p.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/website/img/web-app/icon-72p.png">
  <link rel="apple-touch-icon" sizes="96x96" href="/website/img/web-app/icon-96p.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/website/img/web-app/icon-144p.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/website/img/web-app/icon-192p.png">

  <!-- Android Web App mode -->

  <link rel="manifest" href="/website/manifest.json">




  



</head>

<!-- HEAD End -->


  <body>

    
<!-- Navigation Start -->

<nav class="navbar navbar-custom navbar-fixed-top" role="navigation" style="background:black;">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button>
      
        <a class="navbar-brand" href="/website/">
      
          <div>
            <!--  -->
            Shashidhar
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav">
        
          <!-- Blog, Post, Tag and Error pages -->
          
            <li>
            
                <a href="/website/#about"> About </a>
            
            </li>
          
            <li>
            
              
                <a href="/website/blog/"> Blog </a>
              
            
            </li>
          
            <li>
            
                <a href="/website/#timeline"> Timeline </a>
            
            </li>
          
            <li>
            
                <a href="/website/#contact"> Contact </a>
            
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>

<!-- Navigation End -->


    <section id="post" class="container content-section">
      <div class="row">
        <div class="col-md-10 col-md-offset-1" style="text-align:justify;">

          
<!-- Swipe Instructions Start -->

<div id="swipe-instruction">
  <div>
    <p><br><br><br></p>
    <i id="hand-swipe" class="fa fa-hand-o-up"></i>
    <p><strong>
    
    </strong></p>
    <button type="button" class="btn btn-default ok-btn close-swipe-instruction">
      
    </button>
  </div>
</div>

<!-- Swipe Instructions End -->


          <h1 class="text-center"><strong>Secondary Sorting in Hadoop</strong></h1>
          <h4><strong>30 Jan 2015</strong>
            <!-- <small> .  . <a href="/website/jekyll/update/2015/01/30/secondary-sorting--in-hadoop.html#disqus_thread">Comments</a>
            
            </small> -->
          </h4>

          <p>I have read many blog’s about secondary sorting when I was learning hadoop. Most of these blogs tries to explain it conceptually which is not sufficient as it is kind of hack in hadoop. In this blog let’s see how that can be understood in a better way .We see how data changes internally in each step of secondary sort.</p>

<p>Let’s consider the problem statement given below and solve it with secondary sort.</p>

<p><strong>We have a sales data where there are three columns <code>customerId, itemId, amountPaid</code> with these three columns what we want to is the maximum amount paid by the customer for a single item</strong></p>

<h4 id="example-data"><strong>Example data</strong></h4>

<table>
  <thead>
    <tr>
      <th style="text-align: center">CustomerId</th>
      <th style="text-align: center">ItemId</th>
      <th style="text-align: center">AmountPaid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">100</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">200</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">1000</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">400</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">5</td>
      <td style="text-align: center">350</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">6</td>
      <td style="text-align: center">800</td>
    </tr>
  </tbody>
</table>

<p>For this problem the basic solution is to write map-reduce where mapper will emit <code>key: customerId, value: amountPaid</code>. We get all the amountPaid values for each customer in reduce side. We can easily sort these values by using any sorting technique in reducer.</p>

<p>But as I mentioned we want to solve it in a different way. Now, think of mapreduce frame work in hadoop, how it works. We all have heard about the word sorting in hadoop mapreduce framework. Yes, right!! All the map output keys are sorted by default in hadoop.</p>

<p>Secondary sort is an idea where we keep map output key such a way that we get only required keys in the reduce side, other keys are ignored. To do this we have to make our key value pair from  <code>key:customerId,value:amountPaid</code>  to  	<code>key:&lt;customerId,amountPaid&gt;, 	value:NullWritable</code>.</p>

<p>There are three main phases in mapreduce between mapper and reduce stages, and we have to manipulate all of them to have our solution.</p>

<p><strong>Sorting</strong> : Sorting happens after mapper is finished with all input data. To have our composite key sorted in the required order, customerId by (ascending) and amountPaid by (descending) order, we have to overwrite sorting for compositeKey.</p>

<p><em>Output</em> : <code>&lt;1,1000&gt;,&lt;1,400&gt;,&lt;1,350&gt;,&lt;1,100&gt;,&lt;2,800&gt;,&lt;2,200&gt;</code></p>

<p><strong>Partitioning</strong> : Partitioning determines the reducer for every map-output key. If we leave out composite key here each key can go to different reducer, but we want all the keys for a particular customer should go to the single reducer. To do that we have to overwrite partitioning method. Lets think we have two reducers in our mapreduce job then the output would be,</p>

<p><em>Output</em> : <code>reducer1: &lt;1,1000&gt;,&lt;1,400&gt;,&lt;1,350&gt;,&lt;1,100&gt;</code>
		   <code>reducer2:  &lt;2,800&gt;,&lt;2,200&gt;</code></p>

<p><strong>Grouping</strong>: “Grouping” groups all the map-output key value pairs of the mapper to generate single key with group of value input for the reducer. In our output we still have 4 distinct keys for customerId 1 and 2 distinct keys for customerId 2. But we want only the key with maximum amount to be selected for reduce function ignoring all other keys. To do that we have to overwrite grouping. By default grouping uses complete key <code>&lt;customerId,amountPaid&gt;</code> for grouping, we change it to use only <code>customerId</code> from our key.</p>

<p><em>Output</em> : <code>&lt;1,1000&gt;</code>
		   <code>&lt;2,800&gt;</code></p>

<p>If we look into result of grouping, we are getting only the composite key with maximum amountPaid for each customer. There we got solution for our problem!!!</p>



          
          <br><br>
          
<!-- Social Buttons Start -->
<style>
.social-buttons {
  text-align: center !important;
  margin: 0 0 25px;
  font-size: 18px;
  line-height: 1.5;
  list-style-position: inside;
}
</style>
<ul class="list-inline social-buttons">
  
    <li><a href="https://twitter.com/shashidhares" target="_blank"><i class="fa fa-twitter fa-fw"></i></a></li>
  
    <li><a href="https://github.com/shasidhar" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
  
    <li><a href="https://www.linkedin.com/in/shasidhares" target="_blank"><i class="fa fa-linkedin fa-fw"></i></a></li>
  
    <li><a href="https://www.facebook.com/shashidhar.eranti" target="_blank"><i class="fa fa-facebook fa-fw"></i></a></li>
  
</ul>

<!-- Social Buttons End -->


        </div>
      </div>
    </section>

    
 <!-- Footer Start -->

<footer>
    <div class="container text-center">
      <!-- <p>Copyright &copy; Shashidhar 2015</p> -->
    </div>
</footer>

<p><br><br><br><br><br><br></p>

<!-- Footer End -->


    
<!-- Javascript Start -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<!-- Custom Theme JavaScript -->
<!--* Start Bootstrap - Grayscale Bootstrap Theme (http://startbootstrap.com)
* Code licensed under the Apache License v2.0.
* For details, see http://www.apache.org/licenses/LICENSE-2.0.-->
<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script>









  <!-- Disqus -->

  

  







<script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, 'Secondary Sorting in Hadoop', 'https://shasidhar.github.io/website/jekyll/update/2015/01/30/secondary-sorting--in-hadoop.html');
  }
}
</script>









<!-- Javascript End -->


  </body>
</html>

<!-- Post Layout End -->
