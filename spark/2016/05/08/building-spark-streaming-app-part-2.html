
<!-- Post Layout Start -->

<!DOCTYPE html>
<html lang="en">

  
<!-- HEAD Start -->

<head>
  


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Blog and website of Shashidhar, blogging mainly for tech. Opinions expressed are mine.">
  <meta name="author" content="Shashidhar">
  <meta name="keywords" content="">
  <link rel="canonical" href="/spark/2016/05/08/building-spark-streaming-app-part-2.html">
  <title>Shashidhar  | Building Spark Streaming App - Part 2 (Data Format,Types of Aggregations)</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/css/grayscale.css" rel="stylesheet">
  

  <!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/rrssb.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!--  -->

  

  


  <!-- iOS Web App mode -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="36x36" href="/img/web-app/icon-36p.png">
  <link rel="apple-touch-icon" sizes="48x48" href="/img/web-app/icon-48p.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/web-app/icon-72p.png">
  <link rel="apple-touch-icon" sizes="96x96" href="/img/web-app/icon-96p.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/web-app/icon-144p.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/img/web-app/icon-192p.png">

  <!-- Android Web App mode -->

  <link rel="manifest" href="/manifest.json">




  


  <!-- Syntax highlight in post pages -->

  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/monokai_sublime.min.css">




</head>

<!-- HEAD End -->

  <body>

    
<!-- Navigation Start -->

<nav class="navbar navbar-custom navbar-fixed-top" role="navigation" style="background:black;">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button>
      
        <a class="navbar-brand" href="/">
      
          <div>
            <!--  -->
            Shashidhar
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav">
        
          <!-- Blog, Post, Tag and Error pages -->
          
            <li>
            
                <a href="/#about"> About </a>
            
            </li>
          
            <li>
            
              
                <a href="/blog/"> Blog </a>
              
            
            </li>
          
            <li>
            
                <a href="/#cv"> CV </a>
            
            </li>
          
            <li>
            
                <a href="/#timeline"> Timeline </a>
            
            </li>
          
            <li>
            
                <a href="/#contact"> Contact </a>
            
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>

<!-- Navigation End -->


    <section id="post" class="container content-section">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">

          
<!-- Swipe Instructions Start -->

<div id="swipe-instruction">
  <div>
    <p><br><br><br></p>
    <i id="hand-swipe" class="fa fa-hand-o-up"></i>
    <p><strong>
    
      Did you know that you can navigate the posts by swiping left and right?
    
    </strong></p>
    <button type="button" class="btn btn-default ok-btn close-swipe-instruction">
      
        Awesome!
      
    </button>
  </div>
</div>

<!-- Swipe Instructions End -->


          <h1><strong>Building Spark Streaming App - Part 2 (Data Format,Types of Aggregations)</strong></h1>
          <h4><strong>08 May 2016</strong>
            <!-- <small> .  . <a href="/spark/2016/05/08/building-spark-streaming-app-part-2.html#disqus_thread">Comments</a>
            
            </small> -->
          </h4>

          <p>In previous <a href="http://shashidhare.com/spark/2016/04/08/building-spark-streaming-app-part-1.html">blog</a> we have discussed  about application, a brief overview of the business problem and high level requirements. In this blog we will focus on specifics like what is the required data format? What are the types of aggregations we are interested in?</p>

<p><strong>Data Fromat</strong></p>

<p>The actual input data we were receiving from the Wi-Fi hotspot devices used to capture lot of information. But in this use case we will use dummy data. 
Every record in the input data has five columns and represents single user session within the system for a given time.</p>

<ol>
  <li>Timestamp - Denotes the time when a record in captured.</li>
  <li>Country - Defines country</li>
  <li>State - Defines State</li>
  <li>City - Defines city</li>
  <li>Sensor Status - Defines whether user logged in or not. (True/False)</li>
</ol>

<p>As you observe it’s a pretty simple data to understand and most of the fields are self explanatory. Even with this small data format we will see how much variety of insights we can achieve.</p>

<p><strong><em>Types of Aggregations</em></strong></p>

<p>Now we know the type of data we are dealing with, let’s see what are the insights we want to derive from the data. From high level we can divide aggregations into three categories.</p>

<ol>
  <li>Country wise statistics - We need to get number of users using the Wi-Fi hotspots in a given country</li>
  <li>State wise statistics - We need to get number of users using the Wi-Fi hotspots in a given state</li>
  <li>City wise statistics - We need to get number of users using the Wi-Fi in a given City. Also we need to determine how many users logged in to the system and how many have not.</li>
</ol>

<p>Apart from the above mentioned aggregations we also want to have hourly, weekly and monthly view of every aggregate.</p>

<p>Whenever we think of any software application it is obvious that we cannot achieve every requirement with it.</p>

<p><strong><em>Approach to calculate aggregations</em></strong></p>

<p>If we observe the kind of results we are interested in, it seems pretty straight forward to have 3 tables for every aggregate. Where each table represent hourly, weekly and monthly stats. The idea of having separate tables for different timeframe appears to be clean and elegant idea. But it is not flexible enough. Why?</p>

<p>Let’s say we get a new requirement in future where we want to get the biweekly view of the data along with the existing hourly, weekly and monthly views. In this case we will end up creating another table again. It’s clear that this approach is not flexible. Then what is the right approach?</p>

<p>Better approach is, we just create aggregate of the minimum timeframe we are interested, in this case it is hourly. If we have the hourly aggregation we can derive weekly , monthly , biweekly or any other timeframe in future. May be we cannot go less than an hour in this approach but that is present in the first approach also.</p>

<p>So now our solution to derive required statistics from the data is, we create one table for every aggregate (Country, City, State). Let’s see the structure of the output we will generate.</p>

<ol>
  <li>CountryWiseStats - (datetime,country.count)</li>
  <li>StateWiseStats - (datetime,state.count)</li>
  <li>CityWiseStats - (datetime,city,sensorstatus.count)</li>
</ol>

<p>Once we have the results calculated, next step is to make them available for the user.</p>

<p><strong><em>Reporting</em></strong></p>

<p>If you remember my first blog, we discussed that along with the stats calculations there is a need for reporting mechanism also. So how do we show these hourly, weekly and monthly results in reports? We will use <a href="https://zeppelin.incubator.apache.org/">Apache Zeppelin</a> to display the results.</p>

<p>Zeppelin is a great tool to show the reports in graphs by default. But if you observe our results apart from hourly aggregate, others are still not ready to be shown in charts. We will get the weekly and monthly aggregations calculated on the fly by writing code inside zeppelin notebook. It proves the we are not only using zeppelin just for reporting but also for the processing. In this way zeppelin plays a vital role in achieving our end goal.</p>

<p>It’s also important that if you want to keep track with my blog please make sure to be familiar with zeppelin. You can get started with zeppelin in <a href="http://zeppelin.apache.org/docs/0.6.0-incubating-SNAPSHOT">Zeppelin docs</a></p>

<p>This gives a concrete idea of what is the exact problem and analysis we will perform. In the next post we will directly get into the code snippets to get the required results.</p>



          
          <br><br>
          <div id="disqus_thread"></div>
          <br><br>
          
<!-- Social Buttons Start -->
<style>
.social-buttons {
  text-align: center !important;
  margin: 0 0 25px;
  font-size: 18px;
  line-height: 1.5;
  list-style-position: inside;
}
</style>
<ul class="list-inline social-buttons">
  
    <li><a href="https://twitter.com/shashidhares" target="_blank"><i class="fa fa-twitter fa-fw"></i></a></li>
  
    <li><a href="https://github.com/shasidhar" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
  
    <li><a href="https://www.linkedin.com/in/shasidhares" target="_blank"><i class="fa fa-linkedin fa-fw"></i></a></li>
  
    <li><a href="https://www.facebook.com/shashidhar.eranti" target="_blank"><i class="fa fa-facebook fa-fw"></i></a></li>
  
</ul>

<!-- Social Buttons End -->


        </div>
      </div>
    </section>
    

    
<!-- Javascript Start -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<!-- Custom Theme JavaScript -->
<!--* Start Bootstrap - Grayscale Bootstrap Theme (http://startbootstrap.com)
* Code licensed under the Apache License v2.0.
* For details, see http://www.apache.org/licenses/LICENSE-2.0.-->
<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script>

 <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-71064079-1', 'auto');
    ga('send', 'pageview');
  </script>






  <!-- Syntax highlight in post pages

  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>-->







  <!-- Disqus -->

  

    <script type="text/javascript">
    var disqus_shortname = 'shashidhare';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>

  

  

    <!-- Comments Counter Start -->

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'shashidhare'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

    <!-- Comments Counter End -->

  





  <!-- Share buttons Start -->

  <script src="/js/rrssb.min.js"></script>

  <!-- Share buttons End -->





<script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, 'Building Spark Streaming App - Part 2 (Data Format,Types of Aggregations)', 'https://shasidhare.com/spark/2016/05/08/building-spark-streaming-app-part-2.html');
  }
}
</script>



  <!-- Post Gesture Navigation Start -->

  <script type="text/javascript" src="/js/hammer.min.js"></script>

  <script>
    var post = document.getElementById('post');

    new Hammer(post).on('swipeleft', function(event) {
      addTohistory();
      
        document.location.replace("/spark/2016/04/08/building-spark-streaming-app-part-1.html");
      
    });

    new Hammer(post).on('swiperight', function(event) {
      addTohistory();
      
        document.location.replace("/spark/2016/05/19/building-spark-streaming-app-part-3.html");
      
    });
  </script>

  <!-- Post Gesture Navigation Start -->









  <!-- Swipe Instructions for Post Start -->

  <script>
    $(document).ready(function(){
      if(!localStorage.getItem('post-swipeshowed')){
        $("#swipe-instruction").fadeIn();
        $("#swipe-instruction .close-swipe-instruction").click(function(){
          $("#swipe-instruction").fadeOut();
        });
        localStorage.setItem('post-swipeshowed', true);
      }
    });
  </script>

  <!-- Swipe Instructions for Post End -->



<!-- Javascript End -->



  </body>
</html>

<!-- Post Layout End -->
